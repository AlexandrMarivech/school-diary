{% extends "base.html" %}
{% block content %}
<h4>üë• –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ</h4>

<!-- Flash-—Å–æ–æ–±—â–µ–Ω–∏—è -->
{% with messages = get_flashed_messages(with_categories=true) %}
  {% if messages %}
    {% for category, message in messages %}
      <div class="alert alert-{{ 'danger' if category == 'danger' else 'success' if category == 'success' else 'info' }} alert-dismissible fade show" role="alert">
        {{ message }}
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
      </div>
    {% endfor %}
  {% endif %}
{% endwith %}

<!-- –ö–Ω–æ–ø–∫–∏ -->
<div class="mb-3">
  <a href="{{ url_for('admin_reports') }}" class="btn btn-primary me-2">üìä –£—á—ë—Ç —É—Å–ø–µ–≤–∞–µ–º–æ—Å—Ç–∏</a>
  <a href="{{ url_for('test_dashboard') }}" class="btn btn-info">üß™ –¢–µ—Å—Ç–æ–≤—ã–π –¥–∞—à–±–æ—Ä–¥</a>
</div>

<!-- –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è -->
<div class="card shadow-sm mb-4">
  <div class="card-body">
    <h5 class="card-title">‚ûï –î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</h5>
    <form method="post" class="row g-2">
      <div class="col-md-2"><input name="username" class="form-control form-control-sm" placeholder="login" required></div>
      <div class="col-md-3"><input name="fullname" class="form-control form-control-sm" placeholder="–§–ò–û"></div>
      <div class="col-md-2"><input name="password" class="form-control form-control-sm" placeholder="–ø–∞—Ä–æ–ª—å" required></div>
      <div class="col-md-2">
        <select name="role" class="form-select form-select-sm">
          <option value="student">–£—á–µ–Ω–∏–∫</option>
          <option value="teacher">–£—á–∏—Ç–µ–ª—å</option>
          <option value="admin">–ê–¥–º–∏–Ω</option>
        </select>
      </div>
      <div class="col-md-2"><button class="btn btn-primary btn-sm">–°–æ–∑–¥–∞—Ç—å</button></div>
    </form>
  </div>
</div>

<!-- –°–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π -->
<div class="card shadow-sm">
  <div class="card-body">
    <h5 class="card-title">üìã –°–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</h5>
    <div class="table-responsive">
      <table class="table table-striped align-middle">
        <thead class="table-light">
          <tr>
            <th>ID</th>
            <th>–õ–æ–≥–∏–Ω</th>
            <th>–§–ò–û</th>
            <th>–†–æ–ª—å</th>
            <th class="text-center">–î–µ–π—Å—Ç–≤–∏—è</th>
          </tr>
        </thead>
        <tbody>
          {% for u in users %}
          <tr id="user-row-{{ u.id }}">
            <form method="post" action="{{ url_for('edit_user', user_id=u.id) }}">
              <td>{{ u.id }}</td>
              <td><input name="username" value="{{ u.username }}" class="form-control form-control-sm"></td>
              <td><input name="fullname" value="{{ u.fullname or '' }}" class="form-control form-control-sm"></td>
              <td>
                <select name="role" class="form-select form-select-sm">
                  <option value="student" {% if u.role=='student' %}selected{% endif %}>–£—á–µ–Ω–∏–∫</option>
                  <option value="teacher" {% if u.role=='teacher' %}selected{% endif %}>–£—á–∏—Ç–µ–ª—å</option>
                  <option value="admin" {% if u.role=='admin' %}selected{% endif %}>–ê–¥–º–∏–Ω</option>
                </select>
              </td>
              <td class="text-center">
                {% if u.role != 'admin' %}
                  <input name="password" type="password" class="form-control form-control-sm mb-1" placeholder="–Ω–æ–≤—ã–π –ø–∞—Ä–æ–ª—å (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)">
                  <div class="btn-group btn-group-sm">
                    <button type="submit" class="btn btn-success" title="–°–æ—Ö—Ä–∞–Ω–∏—Ç—å">‚úÖ</button>
                    <form method="post" action="{{ url_for('delete_user', user_id=u.id) }}" style="display:inline;">
                      <button type="submit" class="btn btn-outline-danger" title="–£–¥–∞–ª–∏—Ç—å"
                              onclick="return confirm('–£–¥–∞–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è {{ u.username }}?');">üóë</button>
                    </form>
                  </div>
                {% else %}
                  <span class="text-muted">(–ê–¥–º–∏–Ω ‚Äî –Ω–µ–ª—å–∑—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å/—É–¥–∞–ª—è—Ç—å)</span>
                {% endif %}
              </td>
            </form>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>
{% endblock %}
{% extends "base.html" %}
{% block page_title %}üë®‚Äçüè´ –£—á–∏—Ç–µ–ª—å ‚Äî –≤–≤–æ–¥ –æ—Ü–µ–Ω–æ–∫{% endblock %}
{% block page_subtitle %}–í—ã—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –æ—Ü–µ–Ω–æ–∫ –ø–æ –ø—Ä–µ–¥–º–µ—Ç–∞–º{% endblock %}

{% block content %}
<div class="card shadow-sm mb-3">
    <div class="card-body">
        <h5 class="card-title">üìã –í–≤–æ–¥ –æ—Ü–µ–Ω–æ–∫</h5>
        {% if message %}
            <div class="alert alert-success">{{ message }}</div>
        {% endif %}
        <form method="post" class="row g-3">
            <div class="col-md-3">
                <label class="form-label">–ü—Ä–µ–¥–º–µ—Ç</label>
                <select name="subject_id" class="form-select" required>
                    {% for s in subjects %}
                        <option value="{{ s.id }}">{{ s.name }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="col-md-2">
                <label class="form-label">–ì–æ–¥</label>
                <input type="number" name="year" class="form-control" value="{{ current_year }}" min="2000" max="{{ current_year }}" required>
            </div>
            <div class="col-md-2">
                <label class="form-label">–ß–µ—Ç–≤–µ—Ä—Ç—å</label>
                <select name="quarter" class="form-select" required>
                    <option value="1">1</option>
                    <option value="2">2</option>
                    <option value="3">3</option>
                    <option value="4">4</option>
                </select>
            </div>
            <div class="col-md-2">
                <label class="form-label">–ù–µ–¥–µ–ª—è</label>
                <input type="number" name="week" class="form-control" value="1" min="1" max="52" required>
            </div>
            <div class="col-12">
                <h6>–°–ø–∏—Å–æ–∫ —É—á–µ–Ω–∏–∫–æ–≤</h6>
                <div class="table-responsive">
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>–£—á–µ–Ω–∏–∫</th>
                                <th>–û—Ü–µ–Ω–∫–∞</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for st in students %}
                                <tr>
                                    <td>{{ st.fullname or st.username }}</td>
                                    <td>
                                        <input type="number" name="grade_{{ st.id }}" class="form-control form-control-sm" min="2" max="5" placeholder="2-5">
                                    </td>
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                <button type="submit" class="btn btn-success">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –æ—Ü–µ–Ω–∫–∏</button>
            </div>
        </form>
    </div>
</div>

<div class="card shadow-sm">
    <div class="card-body">
        <h5 class="card-title">üì§ –≠–∫—Å–ø–æ—Ä—Ç –æ—Ç—á—ë—Ç–∞</h5>
        <form class="row g-3" method="get" action="{{ url_for('teacher_report') }}">
            <div class="col-md-3">
                <label class="form-label">–ü—Ä–µ–¥–º–µ—Ç</label>
                <select name="subject" class="form-select">
                    <option value="0">–í—Å–µ</option>
                    {% for s in subjects %}
                        <option value="{{ s.id }}">{{ s.name }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="col-md-2">
                <label class="form-label">–ì–æ–¥</label>
                <input type="number" name="year" class="form-control" value="{{ current_year }}" min="2000" max="{{ current_year }}">
            </div>
            <div class="col-md-2">
                <label class="form-label">–ü–µ—Ä–∏–æ–¥</label>
                <select name="period" class="form-select">
                    <option value="year">–ì–æ–¥</option>
                    <option value="q1">1 –ø–æ–ª—É–≥–æ–¥–∏–µ</option>
                    <option value="q2">2 –ø–æ–ª—É–≥–æ–¥–∏–µ</option>
                    <option value="1">1 —á–µ—Ç–≤–µ—Ä—Ç—å</option>
                    <option value="2">2 —á–µ—Ç–≤–µ—Ä—Ç—å</option>
                    <option value="3">3 —á–µ—Ç–≤–µ—Ä—Ç—å</option>
                    <option value="4">4 —á–µ—Ç–≤–µ—Ä—Ç—å</option>
                </select>
            </div>
            <div class="col-md-5">
                <button class="btn btn-primary mt-4"><i class="bi bi-search"></i> –ü–æ–∫–∞–∑–∞—Ç—å</button>
                <a class="btn btn-outline-secondary mt-4" href="{{ url_for('export_class', subject=request.args.get('subject', 0), year=request.args.get('year', current_year), quarter=request.args.get('quarter', 0)) }}">
                    ‚¨áÔ∏è –°–∫–∞—á–∞—Ç—å CSV
                </a>
            </div>
        </form>
    </div>
</div>
{% endblock %}
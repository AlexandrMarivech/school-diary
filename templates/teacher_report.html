{% extends "base.html" %}
{% block page_title %}üìä –û—Ç—á—ë—Ç –ø–æ –∫–ª–∞—Å—Å—É{% endblock %}
{% block page_subtitle %}–û—Ü–µ–Ω–∫–∏ –∑–∞ {{ year }} –≥–æ–¥{% endblock %}

{% block content %}
<div class="card shadow-sm mb-3">
    <div class="card-body">
        <form class="row g-3" method="get" action="{{ url_for('teacher_report') }}">
            <div class="col-md-3">
                <label class="form-label">–ì–æ–¥</label>
                <input type="number" name="year" class="form-control" value="{{ year }}" min="2000" max="{{ current_year() }}">
            </div>
            <div class="col-md-3">
                <label class="form-label">–ü—Ä–µ–¥–º–µ—Ç</label>
                <select name="subject" class="form-select">
                    <option value="0" {% if subject_id == 0 %}selected{% endif %}>–í—Å–µ</option>
                    {% for subj in subjects %}
                        <option value="{{ subj.id }}" {% if subject_id == subj.id %}selected{% endif %}>{{ subj.name }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="col-md-3">
                <label class="form-label">–ü–µ—Ä–∏–æ–¥</label>
                <select name="period" class="form-select">
                    <option value="year" {% if period == 'year' %}selected{% endif %}>–ì–æ–¥</option>
                    <option value="q1" {% if period == 'q1' %}selected{% endif %}>1 –ø–æ–ª—É–≥–æ–¥–∏–µ</option>
                    <option value="q2" {% if period == 'q2' %}selected{% endif %}>2 –ø–æ–ª—É–≥–æ–¥–∏–µ</option>
                    <option value="1" {% if period == '1' %}selected{% endif %}>1 —á–µ—Ç–≤–µ—Ä—Ç—å</option>
                    <option value="2" {% if period == '2' %}selected{% endif %}>2 —á–µ—Ç–≤–µ—Ä—Ç—å</option>
                    <option value="3" {% if period == '3' %}selected{% endif %}>3 —á–µ—Ç–≤–µ—Ä—Ç—å</option>
                    <option value="4" {% if period == '4' %}selected{% endif %}>4 —á–µ—Ç–≤–µ—Ä—Ç—å</option>
                </select>
            </div>
            <div class="col-md-3">
                <button class="btn btn-primary mt-4"><i class="bi bi-search"></i> –ü–æ–∫–∞–∑–∞—Ç—å</button>
            </div>
        </form>
    </div>
</div>

<div class="card shadow-sm">
    <div class="card-body">
        <div class="d-flex justify-content-between align-items-center mb-2">
            <h5 class="card-title m-0">–ò—Ç–æ–≥–∏ –ø–æ –∫–ª–∞—Å—Å—É</h5>
            <a class="btn btn-outline-secondary btn-sm" href="{{ url_for('export_class', subject=subject_id, year=year, quarter=0 if period == 'year' else period) }}">
                ‚¨á –°–∫–∞—á–∞—Ç—å CSV
            </a>
        </div>
        <div class="table-responsive">
            {% if report_data %}
                <table class="table table-striped align-middle">
                    <thead class="table-light">
                        <tr>
                            <th>–§–ò–û —É—á–µ–Ω–∏–∫–∞</th>
                            <th>–û—Ü–µ–Ω–∫–∏</th>
                            <th>–°—Ä–µ–¥–Ω–∏–π –±–∞–ª–ª</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for name, grades, avg in report_data %}
                            <tr>
                                <td>{{ name }}</td>
                                <td>{{ grades|join(", ") if grades else '‚Äî' }}</td>
                                <td>{{ avg if avg else '-' }}</td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
            {% else %}
                <p class="text-muted">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –∑–∞ –≤—ã–±—Ä–∞–Ω–Ω—ã–π –ø–µ—Ä–∏–æ–¥. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–∏–ª—å—Ç—Ä—ã –∏–ª–∏ –¥–æ–±–∞–≤—å—Ç–µ –æ—Ü–µ–Ω–∫–∏.</p>
            {% endif %}
        </div>
    </div>
</div>

<a href="{{ url_for('teacher_page') }}" class="btn btn-secondary mt-3">‚Üê –ù–∞–∑–∞–¥</a>
{% endblock %}
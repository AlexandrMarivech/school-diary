{% extends "base.html" %}
{% block content %}
<div class="row">
  <!-- –õ–µ–≤–∞—è –ø–∞–Ω–µ–ª—å ‚Äî —Ñ–∏–ª—å—Ç—Ä -->
  <div class="col-md-3 mb-4">
    <div class="card shadow-sm border-0 rounded-3">
      <div class="card-body">
        <h5 class="card-title mb-3 text-primary">üìå –§–∏–ª—å—Ç—Ä</h5>
        <!-- –§–æ—Ä–º–∞ –¥–ª—è –≤—ã–±–æ—Ä–∞ –≥–æ–¥–∞, —á–µ—Ç–≤–µ—Ä—Ç–∏ –∏ –ø—Ä–µ–¥–º–µ—Ç–∞ -->
        <form method="get">
          <!-- –í—ã–±–æ—Ä –≥–æ–¥–∞ -->
          <div class="mb-3">
            <label class="form-label fw-semibold">–ì–æ–¥</label>
            <input name="year" value="{{ year }}" class="form-control form-control-sm">
          </div>
          <!-- –í—ã–±–æ—Ä —á–µ—Ç–≤–µ—Ä—Ç–∏ -->
          <div class="mb-3">
            <label class="form-label fw-semibold">–ß–µ—Ç–≤–µ—Ä—Ç—å</label>
            <input name="quarter" value="{{ quarter }}" class="form-control form-control-sm">
            <div class="form-text">0 = –≤—Å–µ —á–µ—Ç–≤–µ—Ä—Ç–∏</div>
          </div>
          <!-- –í—ã–±–æ—Ä –ø—Ä–µ–¥–º–µ—Ç–∞ -->
          <div class="mb-3">
            <label class="form-label fw-semibold">–ü—Ä–µ–¥–º–µ—Ç</label>
            <select name="subject" class="form-select form-select-sm">
              <option value="0">–í—Å–µ</option>
              {% for s in subjects %}
                <option value="{{ s.id }}" {% if subject_id==s.id %}selected{% endif %}>{{ s.name }}</option>
              {% endfor %}
            </select>
          </div>
          <!-- –ö–Ω–æ–ø–∫–∞ "–ü–æ–∫–∞–∑–∞—Ç—å" -->
          <button class="btn btn-primary w-100 btn-sm">üîé –ü–æ–∫–∞–∑–∞—Ç—å</button>
        </form>
      </div>
    </div>
  </div>

  <!-- –ü—Ä–∞–≤–∞—è –ø–∞–Ω–µ–ª—å ‚Äî –≤—ã–≤–æ–¥ –æ—Ü–µ–Ω–æ–∫ –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ -->
  <div class="col-md-9">
    <div class="card shadow-sm border-0 rounded-3 mb-4">
      <div class="card-body">
        <h4 class="card-title mb-3 text-success">üìñ –û—Ü–µ–Ω–∫–∏</h4>

        <!-- –ï—Å–ª–∏ –æ—Ü–µ–Ω–æ–∫ –Ω–µ—Ç -->
        {% if not grades %}
          <div class="alert alert-info text-center">
            –ó–¥–µ—Å—å –ø–æ–∫–∞ –ø—É—Å—Ç–æ ‚Äî –≤–æ–∑–º–æ–∂–Ω–æ, –æ—Ü–µ–Ω–∫–∏ –µ—â—ë –Ω–µ –≤—ã—Å—Ç–∞–≤–ª–µ–Ω—ã.
          </div>
        {% else %}
          <!-- –¢–∞–±–ª–∏—Ü–∞ —Å –æ—Ü–µ–Ω–∫–∞–º–∏ -->
          <div class="table-responsive">
            <table class="table table-striped table-hover align-middle text-center">
              <thead class="table-light">
                <tr>
                  <th>–ü—Ä–µ–¥–º–µ—Ç</th>
                  <th>–û—Ü–µ–Ω–∫–∞</th>
                  <th>–ì–æ–¥</th>
                  <th>–ß–µ—Ç–≤–µ—Ä—Ç—å</th>
                </tr>
              </thead>
              <tbody>
              {% for g in grades %}
                <tr>
                  <!-- –ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–µ–¥–º–µ—Ç–∞ -->
                  <td class="text-start">{{ subject_map.get(g.subject_id, '') }}</td>
                  <!-- –û—Ü–µ–Ω–∫–∞ –≤ –≤–∏–¥–µ —è—Ä–∫–æ–π –º–µ—Ç–∫–∏ -->
                  <td><span class="badge bg-primary fs-6">{{ g.value }}</span></td>
                  <td>{{ g.year }}</td>
                  <td>{{ g.quarter }}</td>
                </tr>
              {% endfor %}
              </tbody>
            </table>
          </div>

          <!-- –ë–ª–æ–∫ —Å–æ —Å—Ä–µ–¥–Ω–∏–º–∏ –±–∞–ª–ª–∞–º–∏ –ø–æ –ø—Ä–µ–¥–º–µ—Ç–∞–º -->
          <h5 class="mt-4">üìä –°—Ä–µ–¥–Ω–∏–π –±–∞–ª–ª –ø–æ –ø—Ä–µ–¥–º–µ—Ç–∞–º</h5>
          <ul class="list-group list-group-flush">
            {% for k,v in avg.items() %}
              <li class="list-group-item d-flex justify-content-between align-items-center">
                {{ k }}
                <span class="badge bg-success rounded-pill">{{ v }}</span>
              </li>
            {% endfor %}
          </ul>
        {% endif %}
      </div>
    </div>

    <!-- –ö–Ω–æ–ø–∫–∞ –¥–ª—è –ø–µ—Ä–µ—Ö–æ–¥–∞ –≤ –≥–æ–¥–æ–≤–æ–π –æ—Ç—á—ë—Ç -->
    <div class="text-end">
      <a href="{{ url_for('student_report', year=year) }}" class="btn btn-outline-secondary">
        üìë –û—Ç—á—ë—Ç –∑–∞ –≥–æ–¥
      </a>
    </div>
  </div>
</div>
{% endblock %}
